(function(){"use strict";window.hasRegisteredListener=window.hasRegisteredListener||!1;function c(){if(window.hasRegisteredListener){console.log("Listener đã được đăng ký, bỏ qua...");return}chrome.runtime.onMessage.addListener((o,e,t)=>{if(o.type==="INSERT_PHOTO"&&o.photoUrl)return s(o.photoUrl).then(()=>t({success:!0})).catch(r=>t({success:!1,error:r.message})),!0}),window.hasRegisteredListener=!0,console.log("Listener đã được đăng ký")}async function s(o){let e=document.querySelector('div[role="textbox"][contenteditable="true"]');switch(window.location.hostname){case"www.messenger.com":e=document.querySelector('div[role="textbox"][contenteditable="true"]');break;case"www.facebook.com":e=document.querySelector('div[role="textbox"][contenteditable="true"]');break;case"voz.vn":e=document.querySelector(".fr-element.fr-view.fr-element-scroll-visible");break;default:e=document.querySelector("input");break}if(!e)throw new Error("Không tìm thấy khu vực chat. Vui lòng mở box chat trước!");try{const t=await fetch(o,{mode:"cors",credentials:"omit"});if(!t.ok)throw new Error("Không thể tải ảnh từ URL");const r=await t.blob(),l=new File([r],"image.jpg",{type:r.type||"image/jpeg"}),i=new DataTransfer;i.items.add(l);const d=new DragEvent("drop",{bubbles:!0,cancelable:!0,dataTransfer:i});if(e.focus(),await new Promise(n=>setTimeout(n,50)),!e.dispatchEvent(d))throw new Error("Không thể gửi ảnh vào chat");return await new Promise(n=>setTimeout(n,100)),!0}catch(t){throw console.error("Lỗi khi gửi ảnh:",t),new Error("Lỗi: "+t.message)}}const a=window.location.hostname;console.log("Tên miền của app đang login:",a),console.log("content script loaded"),c()})();
